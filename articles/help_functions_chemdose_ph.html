<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Helper Functions &amp; Dose Chemicals • tidywater</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Helper Functions &amp; Dose Chemicals">
<meta name="description" content="This vignette will show how to use some of tidywater's helper functions through chemical additions">
<meta property="og:description" content="This vignette will show how to use some of tidywater's helper functions through chemical additions">
<meta property="og:image" content="https://BrownandCaldwell-Public.github.io/tidywater/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidywater</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidywater.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/coeff_fitting_chemdose_dbp.html">Fitting and using custom coefficients in chemdose_dbp</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_blend_waters.html">Blending Multiple Waters</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_chemdose_ph.html">Helper Functions &amp; Dose Chemicals</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tidywater: Basic functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BrownandCaldwell-Public/tidywater/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Helper Functions &amp; Dose Chemicals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BrownandCaldwell-Public/tidywater/blob/main/vignettes/help_functions_chemdose_ph.Rmd" class="external-link"><code>vignettes/help_functions_chemdose_ph.Rmd</code></a></small>
      <div class="d-none name"><code>help_functions_chemdose_ph.Rmd</code></div>
    </div>

    
    
<p>This vignette assumes a basic understanding of
<code>define_water</code> and the S4 <code>water</code> class. See
<code><a href="../articles/intro.html">vignette("intro", package = "tidywater")</a></code> for more
information.</p>
<div class="section level2">
<h2 id="chemical-dosing-setup">Chemical dosing setup<a class="anchor" aria-label="anchor" href="#chemical-dosing-setup"></a>
</h2>
<p>To showcase tidywater’s acid-base equilibrium functions, let’s use a
common water treatment problem. In this analysis, a hypothetical
drinking water utility wants to know how much their pH will be impacted
by varying doses of alum. They also want to ensure that their finished
water has a pH of 8.</p>
<p>We can create a quick model by manually inputting the utility’s
typical water quality. Then we’ll dose the water with their typical alum
dose of 30 mg/L, and then a proposed 20mg/L dose. Finally, we’ll see how
much caustic is required to raise the pH back to 8.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Use define_water to prepare for tidywater analysis</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>no_alum_water <span class="ot">&lt;-</span> <span class="fu">define_water</span>(<span class="at">ph =</span> <span class="fl">8.3</span>, <span class="at">temp =</span> <span class="dv">18</span>, <span class="at">alk =</span> <span class="dv">150</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Dose 30 mg/L of alum</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>alum_30 <span class="ot">&lt;-</span> no_alum_water <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="fu">chemdose_ph</span>(<span class="at">alum =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="fu">solvedose_ph</span>(<span class="at">target_ph =</span> <span class="dv">8</span>, <span class="at">chemical =</span> <span class="st">"naoh"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>alum_30 <span class="co"># Caustic dose required to raise pH to 8 when 30 mg/L of alum is added</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="sc">&gt;</span><span class="co"># [1] 10.3</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># Dose 20 mg/L of alum</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>alum_20 <span class="ot">&lt;-</span> no_alum_water <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="fu">chemdose_ph</span>(<span class="at">alum =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="fu">solvedose_ph</span>(<span class="at">target_ph =</span> <span class="dv">8</span>, <span class="at">chemical =</span> <span class="st">"naoh"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>alum_20 <span class="co"># Caustic dose required to raise pH to 8 when 20 mg/L of alum is added</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="sc">&gt;</span><span class="co"># [1] 6.2</span></span></code></pre></div>
<p>As expected, a lower alum dose requires a lower caustic dose to reach
the target pH.</p>
<p>Note: How can you remember the difference between
<code>solvedose_ph</code> vs <code>chemdose_ph</code>? Any function
beginning with “solve” is named for what it is solving for based on one
input: SolveWhatItReturns_Input. So, <code>solvedose_ph</code> is
solving for a dose based on a target pH.</p>
<p>Other treatment functions are set up as
WhatHappensToTheWater_WhatYouSolveFor. So with <code>chemdose_ph</code>,
chemicals are being dosed, and we’re solving for the resulting pH (and
other components of acid/base chemistry). <code>chemdose_toc</code>
models the resulting TOC after chemicals are added, and
<code>dissolve_pb</code> calculates lead solubility in the distribution
system.</p>
</div>
<div class="section level2">
<h2 id="multi-scenario-setup-and-intro-to-_df-functions">Multi-scenario setup and intro to <code>_df</code> functions<a class="anchor" aria-label="anchor" href="#multi-scenario-setup-and-intro-to-_df-functions"></a>
</h2>
<p>But what if the utility wants to test a variety of alum doses on a
range of their water quality? Here, we’ll use the power of tidywater’s
<code>_df</code> functions to extend this analysis to a full
dataframe.</p>
<p>We’ll use tidywater’s built-in water quality data,
<code>water_df</code>, then apply <code>define_water_df</code> to
convert the data in the dataframe to a <code>water</code> object in one
column of the dataframe. We use <code>define_water_df</code> so that
other models can be added to the dataframe. This function takes a
dataframe input, then outputs all parameters in a <code>water</code>
class column. This is true for all tidywater functions with the
<code>_df</code> suffix. <code>_df</code> functions are handy in a piped
code block where you’ll need to use many tidywater functions, such as
<code>chemdose_ph</code>, <code>chemdose_toc</code>, etc. After applying
<code>define_water_df</code>, we’ll also use
<code>balance_ions_df</code> to create a new variable with the ions
balanced for all the “raw” <code>water</code> objects in the
dataframe.</p>
<p>We’ll also set a range of alum doses to see how they affect each
water quality scenario.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set a range of alum doses</span></span>
<span></span>
<span><span class="va">alum_doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>alum_dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">60</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use tidywater's built-in synthetic data water_df, for this example</span></span>
<span><span class="va">raw_water</span> <span class="op">&lt;-</span> <span class="va">water_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_water_df.html">define_water_df</a></span><span class="op">(</span>output_water <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/balance_ions.html">balance_ions_df</a></span><span class="op">(</span>input_water <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># join alum doses to create several dosing scenarios</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cross_join.html" class="external-link">cross_join</a></span><span class="op">(</span><span class="va">alum_doses</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="chemdose_ph_df-and-pluck_water">
<code>chemdose_ph_df</code> and <code>pluck_water</code><a class="anchor" aria-label="anchor" href="#chemdose_ph_df-and-pluck_water"></a>
</h2>
<p>Now that we’re set up, let’s dose some alum! To do this, we’ll use
<code>chemdose_ph_df</code>, a function with the <code>_df</code> suffix
introduced earlier but whose tidywater base is <code>chemdose_ph</code>.
The <code>chemdose_ph_df</code> function requires dosed chemicals to
match the argument’s notation or have to be specified when calling the
the function. Most tidywater chemicals are named with their chemical
formula, all lowercase and no special characters.</p>
<p>There are two ways to dose chemicals.</p>
<ol style="list-style-type: decimal">
<li><p>You can pass an appropriately named column into the function,
or</p></li>
<li><p>You can specify the chemical in the function.</p></li>
</ol>
<p>Let’s look at both options using the alum doses from before, and
adding hydrochloric acid. You should notice that the ouputs of both
methods are the same.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># 1. Use existing column in data frame to dose a chemical</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>dose_water <span class="ot">&lt;-</span> raw_water <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hcl =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">chemdose_ph_df</span>(<span class="at">input_water =</span> <span class="st">"raw"</span>, <span class="at">alum =</span> alum_dose, <span class="at">pluck_cols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">pluck_water</span>(<span class="at">input_water =</span> <span class="st">"raw"</span>, <span class="at">parameter =</span> <span class="st">"ph"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(raw, dosed_chem))</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">head</span>(dose_water)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="sc">&gt;</span><span class="co">#                                                 balanced alum_dose hcl</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        20   5</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        30   5</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        40   5</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        50   5</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        60   5</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        20   5</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#   dosed_chem_ph dosed_chem_alk raw_ph</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1          6.60       33.04107    7.9</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2          6.42       27.96961    7.9</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3          6.25       22.98907    7.9</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4          6.07       17.92141    7.9</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5          5.87       12.96700    7.9</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6          6.93       62.87537    8.5</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co"># 2. Dose a chemical in the function</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>dose_water <span class="ot">&lt;-</span> raw_water <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>  <span class="fu">chemdose_ph_df</span>(<span class="at">input_water =</span> <span class="st">"raw"</span>, <span class="at">alum =</span> alum_dose, <span class="at">hcl =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>  <span class="fu">pluck_water</span>(<span class="at">input_water =</span> <span class="fu">c</span>(<span class="st">"raw"</span>, <span class="st">"dosed_chem"</span>), <span class="at">parameter =</span> <span class="st">"ph"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(raw, dosed_chem))</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="fu">head</span>(dose_water)</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="sc">&gt;</span><span class="co">#                                                 balanced alum_dose hcl raw_ph</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        20   5    7.9</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        30   5    7.9</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        40   5    7.9</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        50   5    7.9</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        60   5    7.9</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        20   5    8.5</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#   dosed_chem_ph</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1          6.60</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2          6.42</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3          6.25</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4          6.07</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5          5.87</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6          6.93</span></span></code></pre></div>
<p>Notice in the above code that we used the <code>pluck_water</code>
helper function. This function creates a new column for one selected
parameter from a <code>water</code> class object. You can choose which
<code>water</code> column to pluck from using the
<code>input_water</code> argument. Next, select the parameter of
interest (which must match the water slot’s name). Finally, the output
column’s name will default to the form <code>water_parameter</code>, but
there is an option to name it yourself using the
<code>output_column</code> argument. We can also directly pull out the
output from a model function into its own column with
<code>pluck_cols = TRUE</code> so that you don’t need to apply
<code>pluck_water</code> later.</p>
</div>
<div class="section level2">
<h2 id="solvedose_ph_df">
<code>solvedose_ph_df</code><a class="anchor" aria-label="anchor" href="#solvedose_ph_df"></a>
</h2>
<p>Remember, our original task is to see how alum addition affects the
pH, but the finished water pH needs to be 8. First, we’ll use caustic to
raise the pH to 8. <code>solvedose_ph_df</code> uses
<code>solvedose_ph</code> to calculate the required chemical dose (as
chemical, not product) based on a target pH. Similar to
<code>chemdose_ph_df</code>, <code>solvedose_ph_df</code> can handle
chemical selection and target pH inputs as a column or function
arguments.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>solve_ph <span class="ot">&lt;-</span> raw_water <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">chemdose_ph_df</span>(<span class="st">"raw"</span>, <span class="at">alum =</span> alum_dose) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">target_ph =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">solvedose_ph_df</span>(<span class="at">input_water =</span> <span class="st">"dosed_chem"</span>, <span class="at">chemical =</span> <span class="fu">c</span>(<span class="st">"naoh"</span>, <span class="st">"mgoh2"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(raw, dosed_chem))</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="fu">head</span>(solve_ph)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="sc">&gt;</span><span class="co">#                                                 balanced alum_dose target_ph</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        20         8</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        30         8</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        40         8</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        50         8</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        60         8</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;        20         8</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#   chemical dose</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1     naoh  8.3</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2     naoh 12.3</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3     naoh 16.5</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4     naoh 20.5</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5     naoh 24.4</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6     naoh  6.3</span></span></code></pre></div>
<p>Now that we have the dose required to raise the pH to 8, let’s dose
caustic into the water!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>dosed_caustic_water <span class="ot">&lt;-</span> raw_water <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">chemdose_ph_df</span>(<span class="at">input_water =</span> <span class="st">"raw"</span>, <span class="at">output_water =</span> <span class="st">"alum_dosed"</span>, <span class="at">alum =</span> alum_dose) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">solvedose_ph_df</span>(<span class="at">input_water =</span> <span class="st">"alum_dosed"</span>, <span class="at">target_ph =</span> <span class="dv">8</span>, <span class="at">chemical =</span> <span class="st">"naoh"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="fu">chemdose_ph_df</span>(<span class="at">input_water =</span> <span class="st">"alum_dosed"</span>, <span class="at">output_water =</span> <span class="st">"caustic_dosed"</span>, <span class="at">naoh =</span> dose) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="fu">pluck_water</span>(<span class="at">input_water =</span> <span class="st">"caustic_dosed"</span>, <span class="st">"ph"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(raw<span class="sc">:</span>balanced, alum_dosed))</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="fu">head</span>(dosed_caustic_water)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="sc">&gt;</span><span class="co">#   alum_dose target_ph chemical dose</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1        20         8     naoh  8.3</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2        30         8     naoh 12.3</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3        40         8     naoh 16.5</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4        50         8     naoh 20.5</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5        60         8     naoh 24.4</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6        20         8     naoh  6.3</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                                            caustic_dosed caustic_dosed_ph</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 1 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;             7.99</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 2 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;             7.98</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 3 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;             8.00</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 4 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;             8.02</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 5 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;             8.01</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># 6 &lt;S4 class 'water' [package "tidywater"] with 75 slots&gt;             7.99</span></span></code></pre></div>
<p>You can see the resulting pH from dosing caustic has raised the pH to
8 +/- 0.02 SU. Doses are rounded to the nearest 0.1 mg/L to make the
calculations go a little faster.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>In this tutorial, we were introduced to tidywater helper functions
<code>_df</code>, which can be used to apply base functions to a
dataframe. We also used the <code>pluck_water</code> helper function and
the <code>pluck_cols</code> argument to extract parameters of interest
from our dataframes.</p>
<p>We implemented these helper functions to complete an example dosing
water with coagulant (alum) and adjusting the resulting pH to a target
pH of 8 using <code>solvedose_ph</code> and <code>chemdose_ph</code>
functions. To try another example with helper functions and learn about
the <code>blend_waters</code> function, see
<code>vignette("blend_waters", package = "tidywater")</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sierra Johnson, Libby McKenna, Riley Mulhern, Chris Corwin, Brown and Caldwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
