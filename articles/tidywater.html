<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with tidywater • tidywater</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with tidywater">
<meta name="description" content="Start here if this is your first time using tidywater. You'll learn how to set  up a `water` and how to apply different models to that water.
">
<meta property="og:description" content="Start here if this is your first time using tidywater. You'll learn how to set  up a `water` and how to apply different models to that water.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidywater</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/tidywater.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/coeff_fitting_chemdose_dbp.html">Fitting and using custom coefficients in chemdose_dbp</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_blend_waters.html">Blending Multiple Waters</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_chemdose_ph.html">Helper Functions &amp; Dose Chemicals</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tidywater: Basic functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BrownandCaldwell-Public/tidywater/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with tidywater</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BrownandCaldwell-Public/tidywater/blob/main/vignettes/tidywater.Rmd" class="external-link"><code>vignettes/tidywater.Rmd</code></a></small>
      <div class="d-none name"><code>tidywater.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BrownandCaldwell-Public/tidywater" class="external-link">tidywater</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="defining-an-example-water">Defining an example water<a class="anchor" aria-label="anchor" href="#defining-an-example-water"></a>
</h2>
<p>Most tidywater functions required a <code>water</code> object. Start
by creating a water with <code>define_water</code>. There are a lot of
optional arguments that correspond to different water quality
parameters. Start by specifying everything you know, or at least all the
parameters relevant to the modeling you want to do. Parameters are all
lowercase and use common abbreviations or chemical formulas. If you
aren’t sure what the correct argument name is, check the
<code>define_water</code> documentation. Concentrations are specified in
the most common units - usually mg/L or ug/L depending on the parameter.
Units are also in the documentation, so make sure to check carefully
until you are familiar with the system.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mywater</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_water.html">define_water</a></span><span class="op">(</span></span>
<span>  ph <span class="op">=</span> <span class="fl">7</span>, temp <span class="op">=</span> <span class="fl">15</span>, alk <span class="op">=</span> <span class="fl">100</span>, tot_hard <span class="op">=</span> <span class="fl">100</span>, na <span class="op">=</span> <span class="fl">100</span>, cl <span class="op">=</span> <span class="fl">80</span>,</span>
<span>  cond <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  toc <span class="op">=</span> <span class="fl">3</span>, uv254 <span class="op">=</span> <span class="fl">.02</span>, br <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in define_water(ph = 7, temp = 15, alk = 100, tot_hard = 100, na = 100,</span></span>
<span><span class="co">#&gt; : Missing values for calcium and magnesium but total hardness supplied. Default</span></span>
<span><span class="co">#&gt; ratio of 65% Ca2+ and 35% Mg2+ will be used.</span></span>
<span><span class="co">#&gt; Warning in define_water(ph = 7, temp = 15, alk = 100, tot_hard = 100, na = 100,</span></span>
<span><span class="co">#&gt; : Missing value for DOC. Default value of 95% of TOC will be used.</span></span></code></pre></div>
<p>Now that we have a water, we can apply treatment models to it. The
main models require a <code>water</code> input and will usually output
another <code>water</code> or a number. Functions in tidywater follow
the naming convention <code>treatmentapplied_parametersmodeled</code>.
For example, when we want to dose chemical and see the impact on
pH/alkalinity, we use <code>chemdose_ph</code>. There are a lot of
available chemicals, which you can view with the documentation. Most
chemicals are specified using the chemical formula in all lowercase,
except hydrated coagulants, which are named. Units for the chemical are
also specified, and are usually mg/L as chemical.</p>
</div>
<div class="section level2">
<h2 id="coagulation-model">Coagulation model<a class="anchor" aria-label="anchor" href="#coagulation-model"></a>
</h2>
<p>First, let’s apply a model that will predict the effect of
coagulation on the given <code>mywater</code> conditions we set up
earlier. Start by determining the impact of adding 5 mg/L HCl and 20
mg/L alum as the coagulant.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dosed_water</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemdose_ph.html">chemdose_ph</a></span><span class="op">(</span><span class="va">mywater</span>, hcl <span class="op">=</span> <span class="fl">5</span>, alum <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in chemdose_ph(mywater, hcl = 5, alum = 20): Sulfate-containing</span></span>
<span><span class="co">#&gt; chemical dosed, but so4 water slot is NA. Slot not updated because background</span></span>
<span><span class="co">#&gt; so4 unknown.</span></span>
<span><span class="va">mywater</span><span class="op">@</span><span class="va">ph</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="va">dosed_water</span><span class="op">@</span><span class="va">ph</span></span>
<span><span class="co">#&gt; [1] 6.68</span></span></code></pre></div>
<p>Now <code>dosed_water</code> has updated pH chemistry based on the
hydrochloric acid and alum doses. However, other slots in the water,
such as TOC, have not been updated. If we also want to know how the
coagulant impacts TOC, we need to apply <code>chemdose_toc</code> as
well. This function defaults to published model coefficients, but
because it’s an empirical model, you could also select your own
coefficients.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coag_water</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemdose_toc.html">chemdose_toc</a></span><span class="op">(</span><span class="va">dosed_water</span>, alum <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dosed_water</span><span class="op">@</span><span class="va">doc</span></span>
<span><span class="co">#&gt; [1] 2.85</span></span>
<span><span class="va">coag_water</span><span class="op">@</span><span class="va">doc</span></span>
<span><span class="co">#&gt; [1] 2.428063</span></span></code></pre></div>
<p>The two functions <code>chemdose_ph</code> and
<code>chemdose_toc</code> can also be chained together using the pipe
operator <code>%&gt;%</code> to calculate the changes to pH and TOC more
compactly. Notice that the pH and DOC values returned from
<code>piped_coag_water</code> are the same as those calculated above in
<code>coag_water</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">piped_coag_water</span> <span class="op">&lt;-</span> <span class="va">mywater</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/chemdose_ph.html">chemdose_ph</a></span><span class="op">(</span>hcl <span class="op">=</span> <span class="fl">5</span>, alum <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/chemdose_toc.html">chemdose_toc</a></span><span class="op">(</span>alum <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in chemdose_ph(., hcl = 5, alum = 20): Sulfate-containing chemical</span></span>
<span><span class="co">#&gt; dosed, but so4 water slot is NA. Slot not updated because background so4</span></span>
<span><span class="co">#&gt; unknown.</span></span>
<span></span>
<span><span class="va">piped_coag_water</span><span class="op">@</span><span class="va">ph</span></span>
<span><span class="co">#&gt; [1] 6.68</span></span>
<span><span class="va">piped_coag_water</span><span class="op">@</span><span class="va">doc</span></span>
<span><span class="co">#&gt; [1] 2.428063</span></span></code></pre></div>
<p>We can also solve for chemical doses to achieve a target pH with
<code>solvedose_ph</code>. This function outputs a number instead of a
water.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">caustic_req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solvedose_ph.html">solvedose_ph</a></span><span class="op">(</span><span class="va">coag_water</span>, target_ph <span class="op">=</span> <span class="fl">8.6</span>, chemical <span class="op">=</span> <span class="st">"naoh"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fin_water</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemdose_ph.html">chemdose_ph</a></span><span class="op">(</span><span class="va">coag_water</span>, naoh <span class="op">=</span> <span class="va">caustic_req</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="disinfection-model">Disinfection model<a class="anchor" aria-label="anchor" href="#disinfection-model"></a>
</h2>
<p>We can apply similar principals for disinfection. Note that we have
to specify the chlorine dose in mg/L Cl2 in both
<code>chemdose_ph</code> and <code>chemdose_dbp</code> because they are
calculating two different things. In this example, the DBP function
displays some warnings because the water we are modeling is outside the
bounds of the original model fitting. This is common, and something you
should always be aware of (even if tidywater doesn’t warn you). We can
use <code>summarize_wq</code> to view different groups of parameters in
the water.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist_water</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemdose_ph.html">chemdose_ph</a></span><span class="op">(</span><span class="va">fin_water</span>, naocl <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/chemdose_dbp.html">chemdose_dbp</a></span><span class="op">(</span>cl2 <span class="op">=</span> <span class="fl">4</span>, time <span class="op">=</span> <span class="fl">24</span>, treatment <span class="op">=</span> <span class="st">"coag"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in chemdose_dbp(., cl2 = 4, time = 24, treatment = "coag"): UV254 is</span></span>
<span><span class="co">#&gt; outside the model bounds of 0.016 &lt;= UV254 &lt;= 0.215 cm-1 for coagulated water.</span></span>
<span><span class="co">#&gt; Warning in chemdose_dbp(., cl2 = 4, time = 24, treatment = "coag"): Temperature</span></span>
<span><span class="co">#&gt; is outside the model bounds of temp=20 Celsius for coagulated water.</span></span>
<span><span class="co">#&gt; Warning in chemdose_dbp(., cl2 = 4, time = 24, treatment = "coag"): pH is</span></span>
<span><span class="co">#&gt; outside the model bounds of pH = 7.5 for coagulated water</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_wq.html">summarize_wq</a></span><span class="op">(</span><span class="va">dist_water</span>, <span class="st">"dbps"</span><span class="op">)</span></span></code></pre></div>
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">THMs</th>
<th align="right">Modeled concentration (ug/L)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Chloroform</td>
<td align="right">19.68</td>
</tr>
<tr class="even">
<td align="left">Bromodichloromethane</td>
<td align="right">5.31</td>
</tr>
<tr class="odd">
<td align="left">Dibromochloromethane</td>
<td align="right">2.75</td>
</tr>
<tr class="even">
<td align="left">Bromoform</td>
<td align="right">0.13</td>
</tr>
<tr class="odd">
<td align="left">Total.trihalomethanes</td>
<td align="right">27.87</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">HAAs</th>
<th align="right">Modeled concentration (ug/L)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Chloroacetic.acid</td>
<td align="right">4.86</td>
</tr>
<tr class="even">
<td align="left">Dichloroacetic.acid</td>
<td align="right">6.51</td>
</tr>
<tr class="odd">
<td align="left">Trichloroacetic.acid</td>
<td align="right">11.50</td>
</tr>
<tr class="even">
<td align="left">Bromoacetic.acid</td>
<td align="right">0.90</td>
</tr>
<tr class="odd">
<td align="left">Dibromoacetic.acid</td>
<td align="right">0.13</td>
</tr>
<tr class="even">
<td align="left">Sum.5.haloacetic.acids</td>
<td align="right">23.90</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</div>
<div class="section level2">
<h2 id="summary-and-recommended-resources">Summary and Recommended Resources<a class="anchor" aria-label="anchor" href="#summary-and-recommended-resources"></a>
</h2>
<p>In this tutorial, we walked through how to set up influent water
conditions by specifying water quality parameters using the
<code>define_water</code> function. Then, we applied two common
treatment models, coagulation and disinfection, and predicted the effect
of the chemical addition on pH and TOC and/or DBPs. These functions
return a water object with new water quality parameters, which represent
effluent water conditions. It is important to note that there are
individual functions that update each water quality parameter. Changes
to pH and TOC, for example, require separate functions to calculate,
which can be chained together using the pipe operator
<code>%&gt;%</code>. There are also functions that can solve for the
required chemical dose, such as <code>solvedose_ph</code> which solves
for the chemical dose needed to achieve a target pH value.</p>
<p>Tidywater functions can also be applied to data frames using the
<code>_df</code> suffix. To learn more about those functions, look at
the documentation or read the helper function vignette.</p>
<p>If you want a more detailed introduction to tidywater, check out the
intro vignette.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sierra Johnson, Libby McKenna, Riley Mulhern, Chris Corwin, Brown and Caldwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
