<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Blending Multiple Waters • tidywater</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Blending Multiple Waters">
<meta name="description" content="This vignette will show how to do a water blending analysis using some of tidywater's helper functions.">
<meta property="og:description" content="This vignette will show how to do a water blending analysis using some of tidywater's helper functions.">
<meta property="og:image" content="https://BrownandCaldwell-Public.github.io/tidywater/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidywater</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidywater.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/coeff_fitting_chemdose_dbp.html">Fitting and using custom coefficients in chemdose_dbp</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_blend_waters.html">Blending Multiple Waters</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_chemdose_ph.html">Helper Functions &amp; Dose Chemicals</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tidywater: Basic functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BrownandCaldwell-Public/tidywater/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Blending Multiple Waters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BrownandCaldwell-Public/tidywater/blob/main/vignettes/help_functions_blend_waters.Rmd" class="external-link"><code>vignettes/help_functions_blend_waters.Rmd</code></a></small>
      <div class="d-none name"><code>help_functions_blend_waters.Rmd</code></div>
    </div>

    
    
<p>This vignette assumes a basic understanding of
<code>define_water</code> and the S4 <code>water</code> class. See
<code><a href="../articles/intro.html">vignette("intro", package = "tidywater")</a></code> for more
information. Additionally, for more information on tidywater’s
<code>_df</code> and <code>pluck_waters</code> functions, please see the
<code><a href="../articles/help_functions_chemdose_ph.html">vignette("help_functions_chemdose_ph", package = "tidywater")</a></code>.</p>
<div class="section level2">
<h2 id="blending-analysis-setup">Blending analysis setup<a class="anchor" aria-label="anchor" href="#blending-analysis-setup"></a>
</h2>
<p>In this analysis, a hypothetical drinking water utility sources their
water from a river and a lake, both of which have high hardness. The
operators are investigating whether blending up to 5 MGD from two
groundwater wells will reduce the total hardness below 200 mg/L as
CaCO3.</p>
</div>
<div class="section level2">
<h2 id="well-setup">Well setup<a class="anchor" aria-label="anchor" href="#well-setup"></a>
</h2>
<p>First, let’s take a look at the available groundwater data from Well
A and Well B. We use <code>define_water_df</code> so that other models
can be added to the dataframe.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Read in data from Wells A and B</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>raw_wells_water <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">Well =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">ph =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">9</span>),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">alk =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">temp =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">19</span>),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">ca =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">cond =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">900</span>),</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="at">tds =</span> <span class="fu">c</span>(<span class="dv">300</span>, <span class="dv">500</span>),</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="at">na =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>),</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="at">k =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="at">cl =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>),</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">so4 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="fu">define_water_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  <span class="fu">balance_ions_df</span>()</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>raw_wells_water</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="sc">&gt;</span><span class="co">#  [38;5;246m# A tibble: 2 × 3 [39m</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#   Well  defined balanced</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#    [3m [38;5;246m&lt;chr&gt; [39m [23m  [3m [38;5;246m&lt;list&gt; [39m [23m   [3m [38;5;246m&lt;list&gt; [39m [23m  </span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#  [38;5;250m1 [39m A      [38;5;246m&lt;water&gt; [39m  [38;5;246m&lt;water&gt; [39m </span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#  [38;5;250m2 [39m B      [38;5;246m&lt;water&gt; [39m  [38;5;246m&lt;water&gt; [39m</span></span></code></pre></div>
<p>It’s always a good idea to verify our code is working properly. To
make sure that our data was balanced using <code>balance_ions_df</code>,
we can plot our <code>water</code> class using <code>plot_ions</code>.
The below example shows how to index a <code>water</code> class column:
dataframe$water_class_column[[row_number]]</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ion plot before balance_ions_df was applied</span></span>
<span><span class="va">raw_wells_water</span><span class="op">$</span><span class="va">defined</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/plot_ions.html">plot_ions</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="help_functions_blend_waters_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot of balanced ions</span></span>
<span><span class="va">raw_wells_water</span><span class="op">$</span><span class="va">balanced</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/plot_ions.html">plot_ions</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="help_functions_blend_waters_files/figure-html/unnamed-chunk-3-2.png" width="672"></p>
<p>Let’s continue with our blending analysis. We’re going to treat our
two wells as a single groundwater source. Blending can be calculated as
Well_A_ratio * Well_A concentration + Well_B_ratio *
Well_B_concentration. This is fine for most parameters, but for pH and
acid/base equilibrium species, blending is a little more complicated.
Enter: <code>blend_waters</code>. This function blends waters as you’d
expect, and does all the pH blending math for you. In the example below,
we’re going to be blending inefficiently. But don’t worry, there will be
a better blending example later.</p>
<p>To mix our two wells, we will blend row 1 of
<code>balanced_water</code> with row 2 of <code>balanced_water</code>.
This “vertical” blending is not efficient and will not be useful for
large data frames. <code>water</code> objects cannot be pivoted, hence
the row-to-row blending. In later examples, we will actually blend
columns, which is more amenable to piped code chunks.</p>
<p>The <code>balanced_water</code> function takes 2 or more waters (must
be of the <code>water</code> class), and corresponding ratios for each
water.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Blend "vertically": blends the data in well A's row with that of well B's.</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># The pluck function from the purrr package is useful for indexing a water class column</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">### First, index the water column using the name or number of the column (ie "balanced_water" or 3 (column number))</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">### Next, index the row</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>blended_wells_water <span class="ot">&lt;-</span> <span class="fu">blend_waters</span>(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="at">waters =</span> <span class="fu">c</span>(</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="fu">pluck</span>(raw_wells_water, <span class="st">"balanced"</span>, <span class="dv">1</span>),</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="fu">pluck</span>(raw_wells_water, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  ),</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="at">ratios =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co"># outputs a water class object.</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>blended_wells_water</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="sc">&gt;</span><span class="co"># pH (unitless):  8.72 </span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Temperature (deg C):  18.5 </span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Alkalinity (mg/L CaCO3):  125 </span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Use summary functions or slot names to view other parameters.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="blending-scenarios-and-finish-source-setup">Blending scenarios and finish source setup<a class="anchor" aria-label="anchor" href="#blending-scenarios-and-finish-source-setup"></a>
</h2>
<p>We will create a data frame of the blend scenarios we will be
modeling, in this case, we are varying flow rates from the different
sources.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assume wells can contribute up to 5 MGD each</span></span>
<span><span class="va">groundwater</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Wells_flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Blending scenarios and the resulting source water ratios</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  surface_flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  River_flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Lake_flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cross_join.html" class="external-link">cross_join</a></span><span class="op">(</span><span class="va">groundwater</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    total_flow <span class="op">=</span> <span class="va">River_flow</span> <span class="op">+</span> <span class="va">Lake_flow</span> <span class="op">+</span> <span class="va">Wells_flow</span>,</span>
<span>    River_ratio <span class="op">=</span> <span class="va">River_flow</span> <span class="op">/</span> <span class="va">total_flow</span>,</span>
<span>    Lake_ratio <span class="op">=</span> <span class="va">Lake_flow</span> <span class="op">/</span> <span class="va">total_flow</span>,</span>
<span>    Wells_ratio <span class="op">=</span> <span class="va">Wells_flow</span> <span class="op">/</span> <span class="va">total_flow</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>To finish blending our wells, we will transform the
<code>blended_wells</code> <code>water</code> object into a data frame
containing a <code>water</code> column.</p>
<p>The river and lake sources don’t require any mixing. We’ll set up
their raw data and balance the ions using <code>define_water_df</code>
to make a data frame with a <code>water</code> column. In
<code>balance_ions_df</code>, we are specifying the name of the output
columns so we can use the different water sources later. Most of
tidywater’s <code>_df</code> functions have the option to name the
output column. Defaults vary depending on the <code>_df</code>
function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Wells_water</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>wells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">blended_wells_water</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">River_water</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  ph <span class="op">=</span> <span class="fl">7</span>, temp <span class="op">=</span> <span class="fl">20</span>, alk <span class="op">=</span> <span class="fl">200</span>, tds <span class="op">=</span> <span class="fl">950</span>, cond <span class="op">=</span> <span class="fl">1400</span>,</span>
<span>  tot_hard <span class="op">=</span> <span class="fl">300</span>, na <span class="op">=</span> <span class="fl">100</span>, cl <span class="op">=</span> <span class="fl">150</span>, so4 <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_water_df.html">define_water_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/balance_ions.html">balance_ions_df</a></span><span class="op">(</span>output_water <span class="op">=</span> <span class="st">"river"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">defined</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Lake_water</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  ph <span class="op">=</span> <span class="fl">7.5</span>, temp <span class="op">=</span> <span class="fl">19</span>, alk <span class="op">=</span> <span class="fl">180</span>, tds <span class="op">=</span> <span class="fl">900</span>, cond <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  tot_hard <span class="op">=</span> <span class="fl">350</span>, ca_hard <span class="op">=</span> <span class="fl">250</span>, na <span class="op">=</span> <span class="fl">100</span>, cl <span class="op">=</span> <span class="fl">100</span>, so4 <span class="op">=</span> <span class="fl">150</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_water_df.html">define_water_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/balance_ions.html">balance_ions_df</a></span><span class="op">(</span>output_water <span class="op">=</span> <span class="st">"lake"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">defined</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="blending-multiple-sources">Blending multiple sources<a class="anchor" aria-label="anchor" href="#blending-multiple-sources"></a>
</h2>
<p>Now that we have our 3 sources defined, balanced, and cleaned up, we
can blend them. This next code chunk showcases the power of working in a
data frame. We’ll use <code>blend_waters_df</code>, the helper function
for <code>blend_waters</code>. We already created <code>water</code>
class columns above, so we’ll use those column names in the
<code>waters</code> argument. The ratios for each water source were
calculated in the <code>scenarios</code> data frame. We’ll pass the
names of those ratio columns into the <code>ratio</code> argument. The
ratios must always add up to 1, otherwise the function will not run.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blend_water</span> <span class="op">&lt;-</span> <span class="va">scenarios</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cross_join.html" class="external-link">cross_join</a></span><span class="op">(</span><span class="va">Wells_water</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cross_join.html" class="external-link">cross_join</a></span><span class="op">(</span><span class="va">River_water</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cross_join.html" class="external-link">cross_join</a></span><span class="op">(</span><span class="va">Lake_water</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/blend_waters.html">blend_waters_df</a></span><span class="op">(</span></span>
<span>    waters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wells"</span>, <span class="st">"river"</span>, <span class="st">"lake"</span><span class="op">)</span>,</span>
<span>    ratios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wells_ratio"</span>, <span class="st">"River_ratio"</span>, <span class="st">"Lake_ratio"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>With all three source waters blended for each tested scenario, we can
pull out a parameter of interest using <code>pluck_water</code>.
Finally, we finish by plotting our parameter of interest with the
<code>ggplot</code> package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotting_data</span> <span class="op">&lt;-</span> <span class="va">blend_water</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pluck_water.html">pluck_water</a></span><span class="op">(</span>input_water <span class="op">=</span> <span class="st">"blended"</span>, <span class="st">"tot_hard"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the results!</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plotting_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_flow</span>, y <span class="op">=</span> <span class="va">blended_tot_hard</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Wells_flow</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Hardness (mg/L as CaCO3)"</span>, color <span class="op">=</span> <span class="st">"Well Flow (MGD)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Total Plant Flow (MGD)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="help_functions_blend_waters_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>In this tutorial, we learned how to use the <code>blend_waters</code>
function to determine resulting water quality of multipled mixed
sources. The function inputs <code>water</code> objects and their
blending ratios, and outputs a new column storing updated parameters
with the class <code>water</code>.</p>
<p>We also got more practice using helper functions with the
<code>_df</code> suffix and also <code>pluck_water</code>. For more
context on helper functions or to learn more about the
<code>chemdose_ph</code> and <code>solvedose_ph</code> functions, please
see
<code><a href="../articles/help_functions_chemdose_ph.html">vignette("help_functions_chemdose_ph", package = "tidywater")</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sierra Johnson, Libby McKenna, Riley Mulhern, Chris Corwin, Brown and Caldwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
